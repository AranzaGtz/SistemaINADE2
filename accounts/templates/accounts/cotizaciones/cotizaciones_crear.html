{% extends 'accounts/base_dashboard.html' %}
{% load static %}
{% block title %}
  Crear Cotización
{% endblock %}
{% block header %}
  Crear Cotización
{% endblock %}
{% block content %}
  <!-- TITULO Y FORMULARIO -->
  <div class="container mt-4">
    <h1 class="text-center">Generar Cotización</h1>
    <hr />
    <form action="{% url 'cotizacion_register' %}" method="POST">
      {% csrf_token %}

      <!-- SELECT DE PROSPECTO -->
      <div class="form-group">
        <h2>Prospecto</h2>
        <p>Selecciona un prospecto o crea uno.</p>
        <select name="persona" id="persona-select" class="form-control" onchange="mostrarFormularioNuevoProspecto()">
          <option value="" selected>Selecciona una persona</option>
          {% for persona in personas %}
            <option value="{{ persona.id }}">{{ persona }}</option>
          {% endfor %}
          <option value="nuevo">Crear nuevo prospecto</option>
        </select>
      </div>

      <br>
      <!-- FORMULARIOS DE NUEVO PROSPECTO -->
      <div id="nuevo_prospecto_form" style="display: none;">
        <hr /><br>
        <div class="row">
          <!-- COLUMNA DE PROSPECTO -->
          <div class="col-md-6">
            <h2>Datos del Prospecto</h2>
            <p>Ingresa los datos solicitados para poder registrar el usuario.</p>
            {{ persona_form.as_p }}
            {{ informacion_contacto_form.as_p }}
          </div>

          <!-- COLUMNA DE EMPRESA Y DIRECCIÓN -->
          <div class="col-md-6">
            <h2>Datos de la Empresa</h2>
            {{ empresa_form.as_p }}
            {{ direccion_form.as_p }}
          </div>
        </div>
      </div>

      <!-- BOTONES ACEPTAR Y CANCELAR -->
      <div class="form-group text-right mt-3">
        <input type="submit" class="btn btn-success" value="Siguiente" />
        <input type="button" class="btn btn-danger" value="Cancelar" onclick="location.href='{% url 'cotizaciones_list' %}'" />
      </div>
    </form>
  </div>

  <script>
    function mostrarFormularioNuevoProspecto() {
      var select = document.getElementById('persona-select');
      var nuevoProspectoForm = document.getElementById('nuevo_prospecto_form');
      if (select.value === 'nuevo') {
        nuevoProspectoForm.style.display = 'block';
      } else {
        nuevoProspectoForm.style.display = 'none';
      }
    }
  </script>
{% endblock %}
