{% extends 'accounts/base_dashboard.html' %}
{% load static %}
{% block title %}Usuarios del sistema{% endblock %}
{% block header %}Usuarios del sistema{% endblock %}
{% block content %}
<h1 class="text-center">Usuarios del sistema</h1>

<hr class="featurette-divider">
<div class="row">
    <div class="row mb-3 justify-content-end">
        <div class="col-auto">
            <input type="text" id="searchInput" class="form-control" onkeyup="filterTable('searchInput', 'usuariosTable')" placeholder="Buscar usuarios...">
        </div>
    </div>
    <!-- FORMULARIO -->
    <div class="col-lg-3 col-md-5 mb-2">
        <div class="card shadow-sm">
            <div class="card-header bg-ligth text-dark">
                <strong><h5 class="card-title text-center">{% if edit %}Editar usuario{% else %}Crear nuevo usuario{% endif %}</h5></strong>
            </div>
            <div class="card-body">
                <form action="{% if edit %}{% url 'usuario_edit2' usuario.username %}{% else %}{% url 'usuario_create' %}{% endif %}" method="POST">
                    {% csrf_token %}

                    {% if edit %}
                    <input type="hidden" name="username" value="{{ usuario.username }}">
                    {% endif %}
                    
                    <div class="row m-0">
                        <div class="col-md-12 p-1">
                            <div class="form-group">
                                <label for="id_username">Nombre de usuario</label>
                                <input type="text" name="username" class="form-control" maxlength="150" id="id_username" value="{{ usuario.username|default_if_none:'' }}" {% if edit %}readonly{% endif %} autocomplete="username" />
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="id_first_name">Nombre</label>
                        <input type="text" name="first_name" class="form-control" maxlength="150" id="id_first_name" value="{{ usuario.first_name|default_if_none:'' }}" autocomplete="given-name" />
                        <label for="id_last_name">Apellidos</label>
                        <input type="text" name="last_name" class="form-control" maxlength="150" id="id_last_name" value="{{ usuario.last_name|default_if_none:'' }}" autocomplete="family-name" />
                    </div>

                    <div class="form-group">
                        <label for="id_email">Correo</label>
                        <input type="email" name="email" class="form-control" maxlength="254" id="id_email" value="{{ usuario.email|default_if_none:'' }}" autocomplete="email" />
                        <label for="id_celular">Celular</label>
                        <input type="text" name="celular" class="form-control" maxlength="15" id="id_celular" value="{{ usuario.celular|default_if_none:'' }}" autocomplete="tel" />
                    </div>

                    <div class="form-group">
                        <label for="id_rol">Rol</label>
                        <select class="form-control" name="rol" id="id_rol" autocomplete="role">
                            <option value="" selected="">Elije rol</option>
                            <option value="admin" {% if usuario.rol == "admin" %}selected{% endif %}>Administrador</option>
                            <option value="coordinador" {% if usuario.rol == "coordinador" %}selected{% endif %}>Coordinador</option>
                            <option value="muestras" {% if usuario.rol == "muestras" %}selected{% endif %}>Muestras</option>
                            <option value="informes" {% if usuario.rol == "informes" %}selected{% endif %}>Informes</option>
                            <option value="laboratorio" {% if usuario.rol == "laboratorio" %}selected{% endif %}>Laboratorio</option>
                            <option value="calidad" {% if usuario.rol == "calidad" %}selected{% endif %}>Calidad</option>
                        </select>
                    </div>

                    {% if not edit %}
                    <div class="row m-0">
                        <div class="col-md-6 p-1">
                            <div class="form-group">
                                <label for="id_password1">Contrase√±a</label>
                                <input type="password" name="password1" class="form-control" autocomplete="new-password" required="" id="id_password1" />
                            </div>
                        </div>
                        <div class="col-md-6 p-1">
                            <div class="form-group">
                                <label for="id_password2">Verifique</label>
                                <input type="password" name="password2" class="form-control" autocomplete="new-password" required="" id="id_password2" />
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="form-group text-right">
                        <input type="submit" class="btn btn-success" value="{% if edit %}Actualizar Usuario{% else %}Registrar Usuario{% endif %}" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- SECCION DE LISTADO DE USUARIOS -->
    <div class="col-lg-9 col-md-7">
        <div class="table-responsive" style="max-height: 75vh; overflow-y: auto;">
            <table id="usuariosTable"  class="table table-hover" >
                <thead class="thead-light">
                    <tr>
                        <th >Username</th>
                        <th>Correo</th>
                        <th>Nombre</th>
                        <th>Apellidos</th>
                        <th>Celular</th>
                        <th>Rol</th>
                        <th colspan="2">Opciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in usuarios %}
                    <tr>
                        <td>{{ c.username }}</td>
                        <td>{{ c.email }}</td>
                        <td>{{ c.first_name }}</td>
                        <td>{{ c.last_name }}</td>
                        <td>{{ c.celular }}</td>
                        <td>{{ c.rol }}</td>
                        <td><a href="{% url 'usuario_edit' c.username %}" class="btn btn-primary btn-sm">Editar</a></td>
                        <td><a href="{% url 'usuario_delete' c.username %}" class="btn btn-danger btn-sm">Eliminar</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
